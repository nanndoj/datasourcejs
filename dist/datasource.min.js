!function t(e,i,s){function n(a,h){if(!i[a]){if(!e[a]){var o="function"==typeof require&&require;if(!h&&o)return o(a,!0);if(r)return r(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var u=i[a]={exports:{}};e[a][0].call(u.exports,function(t){var i=e[a][1][t];return n(i?i:t)},u,u.exports,t,e,i,s)}return i[a].exports}for(var r="function"==typeof require&&require,a=0;a<s.length;a++)n(s[a]);return n}({1:[function(t,e,i){e.exports=function(t){"use strict";this.data=[],this.name=t,this.keys=[],this.enabled=!0,this.endpoint=null,this.active={},this.inserting=!1,this.editing=!1,this.fetchSize=2,this.observers=[],this.rowsPerPage=null,this.append=!0,this.headers=null,this._activeValues=null,this.errorMessage="";var e,i=0,s=null,n=!1,r=!1,a=this;this.init=function(){s={save:function(t){return this.call(a.entity,"POST",t,!0)},update:function(t,e){return this.call(t,"PUT",e)},remove:function(t){return this.call(t,"DELETE",null,!0)},call:function(t,e,i){var s;return r=!0,this.$promise=a.request(e,t,i,s).then(function(t){r=!1,s&&s(t.data)},function(t){r=!1,s&&s(t.data)}),this.$promise.then=function(t){s=t},this}},this.isBusy=function(){return r},this.handleError=function(t){var e="";if(t&&401===t.status)e="Username or passoword invalid!";else if(t&&"[object String]"===Object.prototype.toString.call(t.responseText)){var i=/<h1>(.*)<\/h1>/gim,s=i.exec(t.responseText);e=s&&s.length>=2?s[1]:t.responseText}this.errorMessage=e}},this.insert=function(t,e){s.save(t).$promise.then(e)},this.update=function(t,e){var i=h(t),n=this.entity,r="";for(var a in i)i.hasOwnProperty(a)&&(r+="/"+i[a]);n+=r,s.update(n,t).$promise.then(e)},this.post=function(){this.inserting?this.insert(this.active,function(t){this.data.push(t),this.active=t}.bind(this)):this.editing&&this.update(this.active,function(t){var e=h(t);this.data.forEach(function(i){var s;for(var n in e)s=i[n]&&i[n]===e[n]?!0:!1;s&&this.copy(t,i)}.bind(this))}.bind(this)),this.editing=!1,this.inserting=!1},this.cancel=function(){this.inserting&&(this.active=this.data[0]),this.inserting=!1,this.editing=!1},this.startInserting=function(){this.inserting=!0,this.active={},this.onStartInserting&&this.onStartInserting()},this.startEditing=function(t){t&&(this.active=this.copy(t)),this.editing=!0},this.remove=function(t,e){var i=function(t,e){t||(t=this.active);var i=h(t),n="";for(var r in i)i.hasOwnProperty(r)&&(n+="/"+i[r]);e=e||function(){for(var t=0;t<this.data.length;t++){var e;for(var s in i)i.hasOwnProperty(s)&&(e=this.data[t][s]&&this.data[t][s]===i[s]?!0:!1);e&&(this.data.splice(t,1),this.active=t>0?this.data[t-1]:null)}}.bind(this),s.remove(this.entity+n).$promise.then(e)}.bind(this);this.deleteMessage&&this.deleteMessage.length>0?window.confirm(this.deleteMessage)&&i(t,e):i(t,e)};var h=function(t){for(var e={},i=0;i<this.keys.length;i++)e[this.keys[i]]=t[this.keys[i]];return e}.bind(this);this.request=function(t,e,i){var s=function(){},n=s,r=s,a={then:function(t,e){n=t||n,r=e||r}},h=function(){4===this.readyState&&(this.status>=200&&this.status<=299?(n({data:JSON.parse(this.responseText)}),r=s):(r({data:this.responseText}),n=s))},o=new XMLHttpRequest;o.onreadystatechange=h,o.open(t,e,!0);for(var c in this.headers)this.headers.hasOwnProperty(c)&&o.setRequestHeader(c,this.headers[c]);return o.send(i||""),a},this.hasNext=function(){return this.data&&i<this.data.length-1},this.hasPrevious=function(){return this.data&&i>0},this.order=function(t){e.order=t},this.getActiveValues=function(){return this.getRowValues(this.active)},this.__defineGetter__("activeValues",function(){return a.getActiveValues()}),this.getRowValues=function(t){var e=[];for(var i in t)t.hasOwnProperty(i)&&e.push(t[i]);return e},this.next=function(){return this.hasNext()||this.nextPage(),this.active=this.copy(this.data[++i],{}),this.active},this.nextPage=function(){this.hasNextPage()&&(this.offset=parseInt(this.offset)+parseInt(this.rowsPerPage),this.fetch(e,{success:function(t){(!t||t.length<parseInt(this.rowsPerPage))&&(this.offset=parseInt(this.offset)-this.data.length)}}))},this.prevPage=function(){this.append||this.preppend||(this.offset=parseInt(this.offset)-this.data.length,this.offset<0?this.offset=0:this.offset>=0&&this.fetch(e,{success:function(t){t&&0!==t.length||(this.offset=0)}}))},this.hasNextPage=function(){return n&&-1!=this.rowsPerPage},this.hasPrevPage=function(){return this.offset>0&&!this.append&&!this.prepend},this.previous=function(){if(!this.hasPrevious())throw"Dataset Overflor Error";return this.active=this.copy(this.data[--i],{}),this.active},this.goTo=function(t){for(var e=0;e<this.data.length;e++)if(this.data[e][this.key]===t)return i=e,this.active=this.copy(this.data[i],{}),this.active},this.getCursor=function(){return i},this.filter=function(t){var e=this.offset;this.offset=0,this.fetch({path:t},{beforeFill:function(){this.cleanup()},error:function(){this.offset=e}})},this.cleanup=function(){this.offset=0,this.data=[],this.cursor=-1,this.active=null,n=!1},this.current=function(){return this.active||this.data[0]},this.fetch=function(t,s){if(!this.busy){if(!this.enabled)return void this.cleanup();var a=t||{},h=s||{};a.params=a.params||{};var o=this.entity+(a.path||"");this.rowsPerPage>0&&(a.params.limit=this.rowsPerPage,a.params.offset=this.offset),e=a,r=!0,this.$promise=this.request("GET",o,a.params).then(function(t){r=!1,c(t.data)}.bind(this),function(t){r=!1,this.handleError(t.data),h.error&&h.error.call(this,t.data)}.bind(this));var c=function(t){t&&("[object Array]"!==Object.prototype.toString.call(t)&&(t=[t]),h.beforeFill&&h.beforeFill.apply(this,this.data),this.prepend&&(this.data=t.concat(this.data)),this.append&&(this.data=this.data.concat(t)),this.prepend||this.append||(this.data=t,this.active=t[0],i=0),h.success&&h.success.call(this,t),n=t.length>=this.rowsPerPage)}.bind(this)}},this.copy=function(t,e){if(null===t||"[object Object]"!==Object.prototype.toString.call(t))return t;e=e||{};for(var i in t)t.hasOwnProperty(i)&&-1==i.indexOf("$")&&(e[i]=this.copy(t[i]));return e}}},{}],2:[function(t,e,i){var s=t("./core/datasource.js");angular.module("datasourcejs",[]).factory("DatasourceManager",["$http","$q","$timeout","$rootScope",function(t,e,i,n){"use strict";return this.datasources={},this.storeDatasource=function(t){this.datasources[t.name]=t},this.initDatasource=function(e){var i=new s(e.name);if(i.request=function(e,i,s){return t({method:e,url:i,data:s?JSON.stringify(s):null,headers:this.headers})},i.entity=e.entity,i.keys=e.keys&&e.keys.length>0?e.keys.split(","):[],i.rowsPerPage=e.rowsPerPage?e.rowsPerPage:100,i.append=e.append,i.prepend=e.prepend,i.endpoint=e.endpoint,i.filterURL=e.filterURL,i.autoPost=e.autoPost,i.deleteMessage=e.deleteMessage,i.enabled=e.enabled,i.offset=e.offset?e.offset:0,e.headers&&e.headers.length>0){i.headers={};for(var r,a=e.headers.trim().split(";"),h=0;h<a.length;h++)r=a[h].split(":"),2===r.length&&(i.headers[r[0]]=r[1])}if(i.init(),this.storeDatasource(i),!e.lazy&&"[object String]"!==Object.prototype.toString.call(e.watch)&&!e.filterURL){var o={};i.fetch({params:o},{success:function(t){t&&t.length>0&&(this.active=t[0],this.cursor=0)}})}return e.lazy&&e.autoPost&&i.startAutoPost(),e.watch&&"[object String]"===Object.prototype.toString.call(e.watch)&&(this.registerObserver(e.watch,i),i.watchFilter=e.watchFilter),e.filterURL&&e.filterURL.length>0&&i.filter(e.filterURL),n.$watch(function(){return i.active},function(){i._activeValues=i.getRowValues(this.active)},!0),"false"!==e.global&&(n[i.name]=i,window[i.name]=i),i},this}]).directive("datasource",["DatasourceManager","$timeout",function(t,e){return{restrict:"E",scope:!0,template:"",link:function(i,s,n){var r=function(){var i,s={name:n.name,entity:n.entity,enabled:n.hasOwnProperty("enabled")?"true"===n.enabled:!0,keys:n.keys,endpoint:n.endpoint,lazy:n.hasOwnProperty("lazy")&&""===n.lazy||"true"===n.lazy,append:!n.hasOwnProperty("append")||"true"===n.append,prepend:n.hasOwnProperty("prepend")&&""===n.prepend||"true"===n.prepend,watch:n.watch,rowsPerPage:n.rowsPerPage,offset:n.offset,filterURL:n.filter,watchFilter:n.watchFilter,deleteMessage:n.deleteMessage,headers:n.headers,autoPost:n.hasOwnProperty("autoPost")&&""===n.autoPost||"true"===n.autoPost},r={filter:!0,entity:!0,enabled:!0},a=t.initDatasource(s);n.$observe("filter",function(t){r.filter?e(function(){r.filter=!1}):(e.cancel(i),i=e(function(){a.filter(t)},200))}),n.$observe("enabled",function(t){r.enabled?e(function(){r.enabled=!1}):(a.enabled="true"===t,a.fetch({params:{}}))}),n.$observe("entity",function(t){a.entity=t,r.entity?e(function(){r.entity=!1}):a.fetch({params:{}})})};r()}}}]).directive("datasourceName",["DatasourceManager","$parse",function(t,e){return{restrict:"A",scope:!0,link:function(i,s,n){i.data=t.datasources,i.data[n.datasourceName]?i.datasource=i.data[n.datasourceName]:(i.datasource={},i.datasource.data=e(n.datasourceName)(i))}}}])},{"./core/datasource.js":1}]},{},[2]);
//# sourceMappingURL=datasource.js.map
