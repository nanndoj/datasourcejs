(function e$$0(k,l,m){function e(c,b){if(!l[c]){if(!k[c]){var a="function"==typeof require&&require;if(!b&&a)return a(c,!0);if(f)return f(c,!0);a=Error("Cannot find module '"+c+"'");throw a.code="MODULE_NOT_FOUND",a;}a=l[c]={exports:{}};k[c][0].call(a.exports,function(a){var g=k[c][1][a];return e(g?g:a)},a,a.exports,e$$0,k,l,m)}return l[c].exports}for(var f="function"==typeof require&&require,c=0;c<m.length;c++)e(m[c]);return e})({1:[function(r,k,l){k.exports=function(k){this.data=[];this.name=k;
this.keys=[];this.enabled=!0;this.endpoint=null;this.active={};this.editing=this.inserting=!1;this.fetchSize=2;this.observers=[];this.rowsPerPage=null;this.append=!0;this._activeValues=this.headers=null;this.errorMessage="";var e=0,f=null,c,q=!1,b=!1,a=this;this.init=function(){f={save:function(g){return this.call(a.entity,"POST",g,!0)},update:function(a,b){return this.call(a,"PUT",b)},remove:function(a){return this.call(a,"DELETE",null,!0)},call:function(g,t,d){var h;b=!0;this.$promise=a.request(t,
g,d,h).then(function(a){b=!1;h&&h(a.data)},function(a){b=!1;h&&h(a.data)});this.$promise.then=function(a){h=a};return this}};this.isBusy=function(){return b};this.handleError=function(a){var b="";a&&401===a.status?b="Username or passoword invalid!":a&&"[object String]"===Object.prototype.toString.call(a.responseText)&&(b=(b=/<h1>(.*)<\/h1>/gmi.exec(a.responseText))&&2<=b.length?b[1]:a.responseText);this.errorMessage=b}};this.insert=function(a,b){f.save(a).$promise.then(b)};this.update=function(a,
b){var d=n(a),h=this.entity,c="",e;for(e in d)d.hasOwnProperty(e)&&(c+="/"+d[e]);f.update(h+c,a).$promise.then(b)};this.post=function(){this.inserting?this.insert(this.active,function(a){this.data.push(a);this.active=a}.bind(this)):this.editing&&this.update(this.active,function(a){var b=n(a);this.data.forEach(function(d){var h,c;for(c in b)h=d[c]&&d[c]===b[c]?!0:!1;h&&this.copy(a,d)}.bind(this))}.bind(this));this.inserting=this.editing=!1};this.cancel=function(){this.inserting&&(this.active=this.data[0]);
this.editing=this.inserting=!1};this.startInserting=function(){this.inserting=!0;this.active={};if(this.onStartInserting)this.onStartInserting()};this.startEditing=function(a){a&&(this.active=this.copy(a));this.editing=!0};this.remove=function(a,b){var d=function(a,b){a||(a=this.active);var d=n(a),g="",c;for(c in d)d.hasOwnProperty(c)&&(g+="/"+d[c]);b=b||function(){for(var a=0;a<this.data.length;a++){var b,g;for(g in d)d.hasOwnProperty(g)&&(b=this.data[a][g]&&this.data[a][g]===d[g]?!0:!1);b&&(this.data.splice(a,
1),this.active=0<a?this.data[a-1]:null)}}.bind(this);f.remove(this.entity+g).$promise.then(b)}.bind(this);this.deleteMessage&&0<this.deleteMessage.length?window.confirm(this.deleteMessage)&&d(a,b):d(a,b)};var n=function(a){for(var b={},d=0;d<this.keys.length;d++)b[this.keys[d]]=a[this.keys[d]];return b}.bind(this);this.request=function(a,b,d){var c=function(){},e=c,f=c,p=new XMLHttpRequest;p.onreadystatechange=function(){4===this.readyState&&(200<=this.status&&299>=this.status?(e({data:JSON.parse(this.responseText)}),
f=c):(f({data:this.responseText}),e=c))};p.open(a,b,!0);for(var k in this.headers)this.headers.hasOwnProperty(k)&&p.setRequestHeader(k,this.headers[k]);p.send(d||"");return{then:function(a,b){e=a||e;f=b||f}}};this.hasNext=function(){return this.data&&e<this.data.length-1};this.hasPrevious=function(){return this.data&&0<e};this.order=function(a){c.order=a};this.getActiveValues=function(){return this.getRowValues(this.active)};this.__defineGetter__("activeValues",function(){return a.getActiveValues()});
this.getRowValues=function(a){var b=[],d;for(d in a)a.hasOwnProperty(d)&&b.push(a[d]);return b};this.next=function(){this.hasNext()||this.nextPage();return this.active=this.copy(this.data[++e],{})};this.nextPage=function(){this.hasNextPage()&&(this.offset=parseInt(this.offset)+parseInt(this.rowsPerPage),this.fetch(c,{success:function(a){if(!a||a.length<parseInt(this.rowsPerPage))this.offset=parseInt(this.offset)-this.data.length}}))};this.prevPage=function(){this.append||this.preppend||(this.offset=
parseInt(this.offset)-this.data.length,0>this.offset?this.offset=0:0<=this.offset&&this.fetch(c,{success:function(a){a&&0!==a.length||(this.offset=0)}}))};this.hasNextPage=function(){return q&&-1!=this.rowsPerPage};this.hasPrevPage=function(){return 0<this.offset&&!this.append&&!this.prepend};this.previous=function(){if(!this.hasPrevious())throw"Dataset Overflor Error";return this.active=this.copy(this.data[--e],{})};this.goTo=function(a){for(var b=0;b<this.data.length;b++)if(this.data[b][this.key]===
a)return e=b,this.active=this.copy(this.data[e],{})};this.getCursor=function(){return e};this.filter=function(a){var b=this.offset;this.offset=0;this.fetch({path:a},{beforeFill:function(){this.cleanup()},error:function(){this.offset=b}})};this.cleanup=function(){this.offset=0;this.data=[];this.cursor=-1;this.active=null;q=!1};this.current=function(){return this.active||this.data[0]};this.fetch=function(a,f){if(!this.busy)if(this.enabled){var d=a||{},h=f||{};d.params=d.params||{};var k=this.entity+
(d.path||"");0<this.rowsPerPage&&(d.params.limit=this.rowsPerPage,d.params.offset=this.offset);c=d;b=!0;this.$promise=this.request("GET",k,d.params).then(function(a){b=!1;n(a.data)}.bind(this),function(a){b=!1;this.handleError(a.data);h.error&&h.error.call(this,a.data)}.bind(this));var n=function(a){a&&("[object Array]"!==Object.prototype.toString.call(a)&&(a=[a]),h.beforeFill&&h.beforeFill.apply(this,this.data),this.prepend&&(this.data=a.concat(this.data)),this.append&&(this.data=this.data.concat(a)),
this.prepend||this.append||(this.data=a,this.active=a[0],e=0),h.success&&h.success.call(this,a),q=a.length>=this.rowsPerPage)}.bind(this)}else this.cleanup()};this.copy=function(a,b){if(null===a||"[object Object]"!==Object.prototype.toString.call(a))return a;b=b||{};for(var d in a)a.hasOwnProperty(d)&&-1==d.indexOf("$")&&(b[d]=this.copy(a[d]));return b}}},{}],2:[function(r,k,l){var m=r("./datasource.js");angular.module("datasourcejs",[]).factory("DatasourceManager",["$http","$q","$timeout","$rootScope",
function(e,f,c,k){this.datasources={};this.storeDatasource=function(b){this.datasources[b.name]=b};this.initDatasource=function(b){var a=new m(b.name);a.request=function(a,b,c){return e({method:a,url:b,data:c?JSON.stringify(c):null,headers:this.headers})};a.entity=b.entity;a.keys=b.keys&&0<b.keys.length?b.keys.split(","):[];a.rowsPerPage=b.rowsPerPage?b.rowsPerPage:100;a.append=b.append;a.prepend=b.prepend;a.endpoint=b.endpoint;a.filterURL=b.filterURL;a.autoPost=b.autoPost;a.deleteMessage=b.deleteMessage;
a.enabled=b.enabled;a.offset=b.offset?b.offset:0;if(b.headers&&0<b.headers.length){a.headers={};for(var c=b.headers.trim().split(";"),g,f=0;f<c.length;f++)g=c[f].split(":"),2===g.length&&(a.headers[g[0]]=g[1])}a.init();this.storeDatasource(a);b.lazy||"[object String]"===Object.prototype.toString.call(b.watch)||b.filterURL||a.fetch({params:{}},{success:function(a){a&&0<a.length&&(this.active=a[0],this.cursor=0)}});b.lazy&&b.autoPost&&a.startAutoPost();b.watch&&"[object String]"===Object.prototype.toString.call(b.watch)&&
(this.registerObserver(b.watch,a),a.watchFilter=b.watchFilter);b.filterURL&&0<b.filterURL.length&&a.filter(b.filterURL);k.$watch(function(){return a.active},function(){a._activeValues=a.getRowValues(this.active)},!0);"false"!==b.global&&(k[a.name]=a,window[a.name]=a);return a};return this}]).directive("datasource",["DatasourceManager","$timeout",function(e,f){var c;return{restrict:"E",scope:!0,template:"",link:function(k,b,a){(function(){var b={name:a.name,entity:a.entity,enabled:a.hasOwnProperty("enabled")?
"true"===a.enabled:!0,keys:a.keys,endpoint:a.endpoint,lazy:a.hasOwnProperty("lazy")&&""===a.lazy||"true"===a.lazy,append:!a.hasOwnProperty("append")||"true"===a.append,prepend:a.hasOwnProperty("prepend")&&""===a.prepend||"true"===a.prepend,watch:a.watch,rowsPerPage:a.rowsPerPage,offset:a.offset,filterURL:a.filter,watchFilter:a.watchFilter,deleteMessage:a.deleteMessage,headers:a.headers,autoPost:a.hasOwnProperty("autoPost")&&""===a.autoPost||"true"===a.autoPost},g=!0,k=!0,d=!0,h=e.initDatasource(b);
a.$observe("filter",function(a){g?f(function(){g=!1}):(f.cancel(c),c=f(function(){h.filter(a)},200))});a.$observe("enabled",function(a){d?f(function(){d=!1}):(h.enabled="true"===a,h.fetch({params:{}}))});a.$observe("entity",function(a){h.entity=a;k?f(function(){k=!1}):h.fetch({params:{}})})})()}}}]).directive("datasourceName",["DatasourceManager","$parse",function(e,f){return{restrict:"A",scope:!0,link:function(c,k,b){c.data=e.datasources;c.data[b.datasourceName]?c.datasource=c.data[b.datasourceName]:
(c.datasource={},c.datasource.data=f(b.datasourceName)(c))}}}])},{"./datasource.js":1}]},{},[2]);